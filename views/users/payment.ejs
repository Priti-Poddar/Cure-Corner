   <!DOCTYPE html>
<html lang="en">
   <head>
    <link rel="icon" href="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcT1_Crj4a0TQ0ygukVHvHY6nlXH7mEhX9aUkw&s">
    <title>CureCorner</title>
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
	<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

</head>
<body>
    <%- include("../includes/flash.ejs")%>
<div style=" width:60%;display: flex; flex-direction: column; margin: auto; margin-top: 6rem;">
    <form id="payment-form">
    <div style="border: 1px solid rgb(190, 189, 189); margin-bottom: 1rem;border-radius: 15px;">
    <div  style="margin:1rem;display: flex; justify-content: space-between;">
        <h3 ><i><%= cartItem.user.username %> </i></h3>
    <button class="btn btn-dark"><a href="/cart" style="text-decoration: none; color: #fff;">Return to Cart</a></button>
    </div>
    <p style="margin: 1rem;"><%= Add.location %> </p>
        </div>
    <div style="border: 1px solid rgb(190, 189, 189); border-radius: 15px;">
    <h3 style="margin: 1rem;">Your order Subtotal</h3>
    <h4 style="margin: 1rem;">Total Items: <%= cartItem.totalQty %></h4>
          <% if(cartItem.totalCost <299) {%>
    <h4 style="margin: 1rem;" name="amount">Total: <%= (cartItem.totalCost+50).toLocaleString("en-IN") %></h4>
            <%} else { %>
    <h4 style="margin: 1rem;">Total: <%= (cartItem.totalCost+0).toLocaleString("en-IN") %></h4>
        
            <% }%>

    <input type="hidden" id="order_id" name="order_id">
        <button class="btn btn-dark" id="pay-btn" type="submit" style="margin: 1rem;">Pay Now</button>
    </form>

    <button class="btn btn-dark"><a href="/myOrders" style="text-decoration: none; color: #fff;">Go to orders</a></button>

</div>
</div>

</body>

<!--Inside index.html -->
<!-- <script src="https://checkout.razorpay.com/v1/checkout.js"></script> -->

<script>
document.getElementById('pay-btn').addEventListener('click', async (e) => {
            e.preventDefault();
            let amount = 0;
            if('<%= cartItem.totalCost %>'<299){
             amount = '<%= cartItem.totalCost +50 %>'; // Amount in INR
            }else{
             amount = '<%= cartItem.totalCost %>'; // Amount in INR
            }
            // Create an order
            const response = await fetch('/cart/order', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ amount })
            });
            const order = await response.json();

            const options = {
                key: '<%= key %>',
                amount: order.amount,
                currency: order.currency,
                name: 'CureCorner',
                description: 'Test Transaction',
                order_id: order.id,
                // order_id: '12356',
                handler: async function (response) {
                    const verifyResponse = await fetch('/cart/checkout', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            razorpay_order_id: response.razorpay_order_id,
                            razorpay_payment_id: response.razorpay_payment_id,
                            razorpay_signature: response.razorpay_signature
                        })
                    });
                    const verifyResult = await verifyResponse.json();
                    if (verifyResult.status === 'success') {
                        alert('Payment successful');
                    } else {
                        alert('Payment verification failed');
                    }
                },
                prefill: {
                    name: '<%= cartItem.user.username %>',
                    email: '<%= cartItem.user.email %>',
                    contact: '8697684270'
                },
                notes: {
                    address: 'Your address'
                },
                theme: {
                    color: '#3fbfda'
                }
            };

            const rzp1 = new Razorpay(options);
            rzp1.open();
        });
    </script>